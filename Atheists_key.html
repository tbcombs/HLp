<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Todd Combs" />

<meta name="date" content="2018-07-29" />

<title>Atheists Feeling Thermometer</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.0.13/css/fa-svg-with-js.css" rel="stylesheet" />
<script src="site_libs/font-awesome-5.0.13/js/fontawesome-all.min.js"></script>
<script src="site_libs/font-awesome-5.0.13/js/fa-v4-shims.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">RnR: Regression exercises in R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-child"></span>
     
    Exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="STLinequality.html">Exercise 1</a>
    </li>
    <li>
      <a href="ChildPovMSA.html">Exercise 2</a>
    </li>
    <li>
      <a href="Atheists.html">Exercise 3</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-key"></span>
     
    Keys
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="STLinequality_key.html">Exercise 1</a>
    </li>
    <li>
      <a href="ChildPovMSA_key.html">Exercise 2</a>
    </li>
    <li>
      <a href="Atheists_key.html">Exercise 3</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Atheists Feeling Thermometer</h1>
<h4 class="author"><em>Todd Combs</em></h4>
<h4 class="date"><em>July 29, 2018</em></h4>

</div>


<style type="text/css">

@import url('https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,300i,700');

h1, h2, h3, h4, h5, body {
font-family: 'Open Sans Condensed', sans-serif;
}

body{ 
      font-size: 16pt;
      counter-reset:table figure;
  }

.table{
  width:auto;
  font-size:26px;
}

th, td {
    padding-right: 30px;
}

caption::before{
  counter-increment: table;
  content: "Table " counter(table) ": ";
}

.caption::before{
  counter-increment: figure;
  content: "Figure " counter(figure) ": ";
}

caption, .caption{
  font-style:italic;
  font-size: 16px;
  margin-top:0.5em;
  margin-bottom:0.5em;
  width:80%;
  text-align: left;
}

#TOC {
  font-size: 17px;
  width: 100%;
}



</style>
<pre class="r"><code>&#39;# PROLOG   #################################################&#39;   

&#39;# PROJECT: REGRESSION IN R EXERCISES #&#39;   
&#39;# PURPOSE: MULTIVARIATE REGRESSION SURVEY DATA #&#39;   
&#39;# DIR:     Dropbox/R/RegressionInR #&#39;   
&#39;# DATA:    R11705472_SL320.csv #&#39;   
&#39;# AUTHOR:  Todd COMBS #&#39;   
&#39;# CREATED: JULY 29, 2018 #&#39;   
&#39;# LATEST:  JUL 29, 2018 #&#39;   
&#39;# NOTES:   Multivariate regression of Atheist feeling thermometer #&#39;   
&#39;#          Data from Pew religion survey 2017 #&#39;
&#39;# PROLOG   ################################################&#39;  </code></pre>
<p><img src="RnRlogo.png" alt="Regression in R logo" style="float: right;"></p>
<p><br> <br> <br> <br></p>
<div id="todd-combs" class="section level2">
<h2>Todd Combs</h2>
<p>14 August, 2018</p>
<p><br> <br> <br> <br></p>
</div>
<div id="feelings-toward-atheists-cooling-in-america" class="section level1">
<h1>Feelings toward Atheists cooling in America</h1>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p><font size="5"></p>
<p>Historically, results from Pew Religion surveys have shown that of religious groups, Americans’ feelings were coldest for Muslims, and second coldest toward atheists. In 2017, feelings toward atheists warmed, but still practically matched those toward Muslims. You will investigate which types of people have cool or warm feelings toward atheists.</p>
<p>Find and download the American Trends Panel Wave 24 from Pew Religion surveys at: <a href="http://www.pewforum.org/datasets/" class="uri">http://www.pewforum.org/datasets/</a>. You will have to sign up or provide an email address to download the data. The other files (<em>e.g.</em>, topline, questionnaire) come with the dataset and will be helpful.</p>
</div>
<div id="step-1-read-in-data" class="section level2">
<h2>Step 1: Read in data</h2>
<p>Read the data into R. Load only the libraries that you need.</p>
<p>You may also find the adjusted R-squared function we wrote last semester:</p>
<pre class="r"><code>ar2 &lt;- function (srm) # where srm is the survey regression model object
{
  r2 = (srm$null.deviance - srm$deviance)/srm$null.deviance
  adjust = srm$df.null/(srm$df.null - length(coef(srm)))
  value = 1 - ((1 - r2) * adjust)
  return(value)
} 

# Then use ar2(YOURMODELNAME) to calculate the value.</code></pre>
<pre class="r"><code>#libraries
library(tidyverse)
library(magrittr)
library(lmtest)
library(haven)
library(labelled)
library(survey)
library(car)
library(sandwich)

# ADJ R SQUARED FUNCTION 

#adjusted r-squared function
ar2 &lt;- function (srm) # where srm is the survey regression model object
{
  r2 = (srm$null.deviance - srm$deviance)/srm$null.deviance
  adjust = srm$df.null/(srm$df.null - length(coef(srm)))
  value = 1 - ((1 - r2) * adjust)
  return(value)
}  
# data
r &lt;- read_spss(&quot;ATP W24.sav&quot;)</code></pre>
</div>
<div id="step-2-data-management" class="section level2">
<h2>Step 2: Data management</h2>
<p>Find the following variables and rename them with brief, descriptive names, then subset the data to remove all other variables:</p>
<ul>
<li>REL3F_W24</li>
<li>WEIGHT_W24</li>
<li>F_RELIG_FINAL</li>
<li>F_IDEO_FINAL</li>
<li>F_INCOME_FINAL</li>
<li>F_RACETHN_RECRUITMENT</li>
<li>F_EDUCCAT_FINAL</li>
<li>F_AGECAT_FINAL</li>
<li>F_CREGION_FINAL</li>
<li>F_SEX_FINAL</li>
<li>REL5_W24</li>
<li>KIND1_W24</li>
</ul>
<p>Recode the variables into factors. Create five categories for religion: Protestant, Catholic, Atheist/Agnostic, Not religious, and Other (all others). Create three categories for income: less than $30k, $30-75k, &amp; $75 and over. Create descriptve factor level names for all variables except the atheist feeling thermometer and the weighting variable.</p>
<p>Next, declare the data as a survey design.</p>
<pre class="r"><code># make variable dictionary
rlabs &lt;- tibble(var = names(r), labels =as.character(var_label(r)))
rlabs2 &lt;- rlabs %&gt;%
  mutate(labels = str_sub(labels,start=95))
# rename vars
r &lt;- r %&gt;%
  rename(atheistFT = REL3F_W24, 
         weight = WEIGHT_W24,
         relig = F_RELIG_FINAL,
         ideo = F_IDEO_FINAL,
         income = F_INCOME_FINAL,
         raceth = F_RACETHN_RECRUITMENT,
         ed = F_EDUCCAT_FINAL,
         age = F_AGECAT_FINAL,
         reg = F_CREGION_FINAL,
         sex = F_SEX_FINAL,
         knowNonRelig = REL5_W24,
         kind = KIND1_W24)

r &lt;- r %&gt;%
  select(atheistFT,weight, relig, ideo, income, raceth,
         ed, age, reg, sex, knowNonRelig, kind)

# recodes

r &lt;- r %&gt;%
  mutate(relig = case_when(relig==1~&quot;Protestant&quot;,
                           relig==2~&quot;Roman Catholic&quot;,
                           relig %in% 9:10~&quot;Atheist/Agnostic&quot;,
                           relig==12~&quot;None&quot;,
                           relig %in% c(3:8,11,13:14)~&quot;Other&quot;),
         ideo = case_when(ideo %in% 1:2~&quot;Conservative&quot;,
                          ideo==3~&quot;Moderate&quot;,
                          ideo %in% 4:5~&quot;Liberal&quot;),
         income = case_when(income %in% 1:3~&quot;&lt;$30k&quot;,
                            income %in% 4:6~&quot;$30-75k&quot;,
                            income %in% 7:9~&quot;&gt;$75k&quot;),
         raceth = case_when(raceth==1~&quot;White&quot;,
                            raceth==2~&quot;Black&quot;,
                            raceth==3~&quot;Hispanic&quot;,
                            raceth==4~&quot;Other&quot;),
         ed = case_when(ed==1~&quot;College grad&quot;,
                        ed %in% 2:3~&quot;No degree&quot;),
         age = case_when(age==1~&quot;18-29&quot;,
                         age==2~&quot;30-49&quot;,
                         age==3~&quot;50-64&quot;,
                         age==4~&quot;65+&quot;),
         reg = case_when(reg==1~&quot;Northeast&quot;,
                         reg==2~&quot;Midwest&quot;,
                         reg==3~&quot;South&quot;,
                         reg==4~&quot;West&quot;),
         sex = case_when(sex==1~&quot;Male&quot;,
                         sex==2~&quot;Female&quot;),
         knowNonRelig = case_when(knowNonRelig==1~&quot;Yes&quot;,
                                  knowNonRelig==2~&quot;No&quot;),
         kind = case_when(kind==1~&quot;People are kind&quot;,
                          kind==2~&quot;People are unkind&quot;))
r &lt;- r %&gt;%
  mutate_at(vars(3:12),factor)
  
 
 
rs &lt;- svydesign(ids=~1, data=na.omit(r), weights=~weight)  </code></pre>
</div>
<div id="step-3-data-visualization" class="section level2">
<h2>STEP 3: Data visualization</h2>
<p>Since all the predictor variables are factors, use the <code>svyby</code> function to create accurately weighted mean atheist feeling thermometer values for the different categories of each variable. Use these to create descriptive plots.</p>
<pre class="r"><code>#create empty list to catch tables
mylist &lt;- vector(&#39;list&#39;,ncol(rs$variables)-2)
# get IV names
myvars2 &lt;- names(r)[3:12]

# write function to create weighted means by group
scsloop &lt;- function( vars , design ){ as_tibble(svyby(~atheistFT,by= as.formula( paste0( &quot;~&quot; , vars ) ) , design , FUN=svymean, na.rm=T, vartype = &#39;ci&#39;)) }

# apply function
for (i in 1:length(mylist)) {
  mylist[[i]] &lt;- scsloop(myvars2[i], rs)
  mylist[[i]] &lt;- mylist[[i]] %&gt;%
    mutate(var = as.character(myvars2[i]))
  names(mylist[[i]])[1] &lt;- &quot;IV&quot;
}

# to tibble
mytabs &lt;- bind_rows(mylist)

# pretty labels
mytabs &lt;- mytabs %&gt;%
  mutate(var = case_when(var==&#39;relig&#39;~&quot;Religion&quot;,
                         var==&quot;ideo&quot;~&quot;Political ideology&quot;,
                         var==&quot;income&quot;~&quot;Income group&quot;,
                         var==&quot;age&quot;~&quot;Age group&quot;,
                         var==&quot;ed&quot;~&quot;Education&quot;,
                         var==&quot;kind&quot;~&quot;Are people generally kind?&quot;,
                         var==&quot;knowNonRelig&quot;~&quot;Do you know anyone who is not Religious?&quot;,
                         var==&quot;raceth&quot;~&quot;Race/ethnicity&quot;,
                         var==&quot;sex&quot;~&quot;Sex&quot;, 
                         var==&quot;reg&quot;~&quot;Region&quot;))
# plot
g &lt;- mytabs %&gt;%
  ggplot(aes(y=reorder(IV, atheistFT),
             x=atheistFT, xmin=ci_l, xmax=ci_u,color=var))

g &lt;- g + geom_errorbarh(height=0.25) + geom_point() +
  facet_wrap(~var, scales=&#39;free_y&#39;, nrow = 5) + 
  theme_minimal() + theme(legend.position = &#39;none&#39;) +
  labs(x=&quot;Mean atheist feeling thermometer with 95% CIs&quot;,
       y=&quot;&quot;)


g</code></pre>
<div class="figure">
<img src="Atheists_key_files/figure-html/dataViz-1.png" alt="Average ratings by group" width="1152" />
<p class="caption">
Average ratings by group
</p>
</div>
</div>
<div id="step-4-model" class="section level2">
<h2>STEP 4: Model</h2>
<p>Execute the model. Inspect the results. Remove the three variables that are least significant. Compute the adjusted R-squared value for the second model.</p>
<pre class="r"><code>m1 &lt;- svyglm(atheistFT~relig+ideo+income+raceth+ed+age+
               reg+sex+knowNonRelig+kind,
             design=rs)  
  
m2 &lt;- svyglm(atheistFT~relig+income+ed+age+knowNonRelig+ideo+kind,
             design=rs)  



ar2(m2)</code></pre>
<pre><code>## [1] 0.231778</code></pre>
</div>
<div id="step-5-diagnostics" class="section level2">
<h2>STEP 5: Diagnostics</h2>
<p>Since the <code>svyglm</code> function computes robust standard errors, this should be sufficient in terms of potentially heteroskedastic errors. Also, since all of the predictors are categorical, it is unnecessary (and impossible) to check for linear relationships. Check the model for influential observations. Create a plot of the cook’s d values and re-run the model without influential observations if necessary. Compare the estimates and decide what to do.</p>
<pre class="r"><code># SVYGLM computes robust standard errors so these should suffice for
# potential heteroskedasticity

# outliers/influential obs
g &lt;- ggplot(m2, aes(seq_along(.cooksd), .cooksd))
r2 &lt;- as_tibble(g$data)
r3 &lt;- rs$variables %&gt;%
  mutate(cooksd = r2 %$% .cooksd)

r3 &lt;- r3 %&gt;%
  mutate(high = case_when(cooksd&gt;mean(cooksd)*3~&quot;Over 3*mean(cooks&#39;d)&quot;,
                          cooksd&lt;=mean(cooksd)*3~&quot;Acceptable        &quot;),
         obs = row_number()) 

g &lt;- r3 %&gt;%
  ggplot(aes(x=obs, y=cooksd, color=high))

g &lt;- g + geom_point()


g &lt;- g+labs(x=&quot;Obs. Number&quot;, y=&quot;Cook&#39;s distance&quot;, color=&quot;&quot;,title=&quot;Cook&#39;s distance&quot;)

g &lt;- g  + theme_minimal() + theme(legend.position = &#39;top&#39;)

g</code></pre>
<div class="figure">
<img src="Atheists_key_files/figure-html/infOut-1.png" alt="Cook's D values" width="1152" />
<p class="caption">
Cook’s D values
</p>
</div>
<pre class="r"><code>rs2 &lt;- svydesign(ids=~1, data=r3, weights=~weight)

rs3 &lt;- subset(rs2, cooksd&lt;0.005)


m3 &lt;- svyglm(atheistFT~relig+income+ed+age+knowNonRelig+ideo+kind,
             design=rs3)  

# coefs aren&#39;t that different, so we&#39;ll use all obs (m2)</code></pre>
</div>
<div id="step-6-model-results" class="section level2">
<h2>STEP 6: Model results</h2>
<p>Create a coefficient plot of the estimates from the model. Discuss the overall model fit and interpret each statistically significant coefficient.</p>
<pre class="r"><code># coefplot

myco &lt;- summary(m2)$coef[-1,1:2]

myco &lt;- as_tibble(myco) %&gt;%
  mutate(lab=c(&quot;Religion: None v. atheists&quot;,
        &quot;Religion: Other v. atheists&quot;,
        &quot;Religion: Protestant v. atheists&quot;,
        &quot;Religion: Catholic v. atheists&quot;,
        &quot;Income: &lt;$30k v. $30-75k&quot;,
        &quot;Income: &gt;$75k v. $30-75k&quot;,
        &quot;Education: College degree v. none&quot;,
        &quot;Age: 30-49 v. 18-30&quot;,
        &quot;Age: 50-64 v. 18-30&quot;,
        &quot;Age: 65+ v. 18-30&quot;,
        &quot;Know someone who is not religious: Yes&quot;,
        &quot;Liberal v. Conservative&quot;,
        &quot;Moderate v. Conservative&quot;,
        &quot;People are generally kind: No&quot;))

names(myco) &lt;-  c(&quot;est&quot;,&quot;se&quot;,&quot;lab&quot;)

myco &lt;- myco %&gt;%
  mutate(lb=est-se*1.96,
         ub=est+se*1.96)
  
# plot

g &lt;- myco %&gt;%
  ggplot(aes(x=est,xmin=lb,xmax=ub,y=reorder(lab,est)))

g &lt;- g + geom_errorbarh(height=0.25) + geom_point()

g &lt;- g + labs(x=&quot;Estimate with 95% confidence intervals&quot;,
              y=&quot;&quot;,subtitle=&quot;N: 4048, Adj. R-sq: 0.232&quot;)
g &lt;- g + geom_vline(xintercept=0,color=&quot;red&quot;,linetype=2) +
  theme_minimal()

g</code></pre>
<div class="figure">
<img src="Atheists_key_files/figure-html/coefPlot-1.png" alt="Model results" width="1152" />
<p class="caption">
Model results
</p>
</div>
</div>
<div id="step-7-predictions" class="section level2">
<h2>STEP 7: Predictions</h2>
<p>Create a plot that compares the predicted atheist feeling thermometer values for the average respondent who is politically liberal with one that is conservative.</p>
<p>Create at least one more comparison plot and discuss both.</p>
<pre class="r"><code># predictions

# liberal v. conservative

r4 &lt;- r3 %&gt;%
  select(1:12)

map(r4 %&gt;% select(-weight,-atheistFT), table)</code></pre>
<pre><code>## $relig
## 
## Atheist/Agnostic             None            Other       Protestant 
##              540              524              508             1733 
##   Roman Catholic 
##              743 
## 
## $ideo
## 
## Conservative      Liberal     Moderate 
##         1316         1253         1479 
## 
## $income
## 
## $30-75k   &lt;$30k   &gt;$75k 
##    1448     859    1741 
## 
## $raceth
## 
##    Black Hispanic    Other    White 
##      325      315      254     3154 
## 
## $ed
## 
## College grad    No degree 
##         2126         1922 
## 
## $age
## 
## 18-29 30-49 50-64   65+ 
##   487  1171  1310  1080 
## 
## $reg
## 
##   Midwest Northeast     South      West 
##       916       726      1406      1000 
## 
## $sex
## 
## Female   Male 
##   2027   2021 
## 
## $knowNonRelig
## 
##   No  Yes 
##  677 3371 
## 
## $kind
## 
##   People are kind People are unkind 
##              2734              1314</code></pre>
<pre class="r"><code>lib &lt;- as_tibble(r4) %&gt;%
  mutate(relig = as_factor(&quot;Protestant&quot;, levels=levels(r %$% relig)),
         ideo = as_factor(&quot;Liberal&quot;, levels=levels(r %$% ideo)),
         income=as_factor(&quot;$30-75k&quot;, levels=levels(r %$% income)),
         raceth=as_factor(&quot;White&quot;, levels=levels(r %$% raceth)),
         ed=as_factor(&quot;College grad&quot;, levels=levels(r %$% ed)),
         age=as_factor(&quot;50-64&quot;, levels=levels(r %$% age)),
         knowNonRelig= as_factor(&quot;Yes&quot;, levels(r %$% knowNonRelig)),
         kind = as_factor(&quot;People are kind&quot;, levels(r %$% kind)))

cons &lt;- as_tibble(r4) %&gt;%
  mutate(relig = as_factor(&quot;Protestant&quot;, levels=levels(r %$% relig)),
         ideo = as_factor(&quot;Conservative&quot;, levels=levels(r %$% ideo)),
         income=as_factor(&quot;$30-75k&quot;, levels=levels(r %$% income)),
         raceth=as_factor(&quot;White&quot;, levels=levels(r %$% raceth)),
         ed=as_factor(&quot;College grad&quot;, levels=levels(r %$% ed)),
         age=as_factor(&quot;50-64&quot;, levels=levels(r %$% age)),
         knowNonRelig= as_factor(&quot;Yes&quot;, levels(r %$% knowNonRelig)),
         kind = as_factor(&quot;People are kind&quot;, levels(r %$% kind)))

# Protestant v. non-religious
prot &lt;- as_tibble(r4) %&gt;%
  mutate(relig = as_factor(&quot;Protestant&quot;, levels=levels(r %$% relig)),
         ideo = as_factor(&quot;Moderate&quot;, levels=levels(r %$% ideo)),
         income=as_factor(&quot;$30-75k&quot;, levels=levels(r %$% income)),
         raceth=as_factor(&quot;White&quot;, levels=levels(r %$% raceth)),
         ed=as_factor(&quot;College grad&quot;, levels=levels(r %$% ed)),
         age=as_factor(&quot;50-64&quot;, levels=levels(r %$% age)),
         knowNonRelig= as_factor(&quot;Yes&quot;, levels(r %$% knowNonRelig)),
         kind = as_factor(&quot;People are kind&quot;, levels(r %$% kind)))

norel &lt;- as_tibble(r4) %&gt;%
  mutate(relig = as_factor(&quot;None&quot;, levels=levels(r %$% relig)),
         ideo = as_factor(&quot;Moderate&quot;, levels=levels(r %$% ideo)),
         income=as_factor(&quot;$30-75k&quot;, levels=levels(r %$% income)),
         raceth=as_factor(&quot;White&quot;, levels=levels(r %$% raceth)),
         ed=as_factor(&quot;College grad&quot;, levels=levels(r %$% ed)),
         age=as_factor(&quot;50-64&quot;, levels=levels(r %$% age)),
         knowNonRelig= as_factor(&quot;Yes&quot;, levels(r %$% knowNonRelig)),
         kind = as_factor(&quot;People are kind&quot;, levels(r %$% kind)))

lp &lt;- predict(m2, newdata = lib, se.fit=T)
lp &lt;- tibble(est=lp[1], se=sqrt(attr(lp,&quot;var&quot;)[1]),varn=&quot;Liberal Protestant&quot;)

cp &lt;- predict(m2, newdata = cons, se.fit=T)
cp &lt;- tibble(est=cp[1], se=sqrt(attr(cp,&quot;var&quot;)[1]),varn=&quot;Conservative Protestant&quot;)

pp &lt;- predict(m2, newdata = prot, se.fit=T)
pp &lt;- tibble(est=pp[1], se=sqrt(attr(pp,&quot;var&quot;)[1]),varn=&quot;Protestant-Moderate&quot;)

np &lt;- predict(m2, newdata = norel, se.fit=T)
np &lt;- tibble(est=np[1], se=sqrt(attr(np,&quot;var&quot;)[1]),varn=&quot;Not religious-Moderate&quot;)


mypred &lt;- bind_rows(lp,cp,pp,np)
mypred &lt;- mypred %&gt;%
  mutate(lb=est-se*1.96,
         ub=est+se*1.96)

g &lt;- mypred %&gt;%
  ggplot(aes(x=varn, y=est, ymin=lb, ymax=ub))

g &lt;- g + geom_errorbar(width=0.25) + geom_point()

g &lt;- g + labs(y=&quot;Predicted Atheist feeling thermometer (95% CIs)&quot;,
              x=&quot;&quot;) + theme_minimal()

g</code></pre>
<div class="figure">
<img src="Atheists_key_files/figure-html/preds-1.png" alt="Predicted atheist feeling thermometer values by political ideology and religious beliefs, for average Americans" width="1152" />
<p class="caption">
Predicted atheist feeling thermometer values by political ideology and religious beliefs, for average Americans
</p>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
